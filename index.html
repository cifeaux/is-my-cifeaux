<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Is My Cifeaux? - Test Your #CCFF00 Colour Perception</title>
    <meta name="description" content="An interactive test to see if your yellow-green is close enough to the one true cifeaux (#CCFF00). Adaptive test with personality-based results.">

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-N498PE7E7L"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-N498PE7E7L');
    </script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #000;
            color: #fff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            max-width: 600px;
            width: 100%;
            text-align: center;
        }

        h1 {
            font-size: clamp(2rem, 5vw, 3.5rem);
            margin-bottom: 1rem;
            font-weight: 700;
            letter-spacing: -0.02em;
        }

        .subtitle {
            font-size: 1.1rem;
            color: #aaa;
            margin-bottom: 3rem;
            line-height: 1.5;
        }

        .color-display {
            width: 100%;
            height: 300px;
            margin: 2rem 0;
            border-radius: 12px;
            transition: background-color 0.5s ease;
            box-shadow: 0 20px 60px rgba(204, 255, 0, 0.3);
        }

        .question {
            font-size: 1.5rem;
            margin: 2rem 0 1.5rem;
            font-weight: 500;
        }

        .color-code {
            font-family: 'Courier New', monospace;
            font-size: 1.2rem;
            color: #CCFF00;
            margin: 1rem 0 2rem;
            letter-spacing: 0.05em;
        }

        .button-group {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin: 2rem 0;
        }

        button {
            padding: 1rem 3rem;
            font-size: 1.2rem;
            font-weight: 600;
            border: 2px solid #CCFF00;
            background: transparent;
            color: #CCFF00;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.2s ease;
            min-width: 120px;
        }

        button:hover {
            background: #CCFF00;
            color: #000;
            transform: translateY(-2px);
        }

        button:active {
            transform: translateY(0);
        }

        .progress {
            color: #666;
            font-size: 0.9rem;
            margin-top: 2rem;
        }

        /* Results Page */
        .results {
            display: none;
        }

        .results.active {
            display: block;
        }

        .verdict {
            font-size: 2rem;
            color: #CCFF00;
            margin: 2rem 0 1rem;
            font-weight: 700;
        }

        .verdict-description {
            color: #aaa;
            margin-bottom: 3rem;
            font-size: 1.1rem;
            line-height: 1.6;
        }

        .gradient-container {
            margin: 3rem 0;
            position: relative;
        }

        .gradient {
            width: 100%;
            height: 80px;
            border-radius: 8px;
            position: relative;
            margin: 1rem 0;
        }

        .marker {
            position: absolute;
            top: -30px;
            transform: translateX(-50%);
            font-size: 0.85rem;
            white-space: nowrap;
        }

        .marker.true-cifeaux {
            color: #CCFF00;
            font-weight: 700;
            font-size: 1rem;
        }

        .marker::after {
            content: '▼';
            display: block;
            text-align: center;
        }

        .range-indicator {
            position: absolute;
            height: 100%;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid #fff;
            border-radius: 4px;
            top: 0;
        }

        .stats {
            margin: 3rem 0;
            padding: 2rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            border: 1px solid rgba(204, 255, 0, 0.2);
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            margin: 1rem 0;
            font-size: 1rem;
        }

        .stat-label {
            color: #aaa;
        }

        .stat-value {
            color: #CCFF00;
            font-weight: 600;
        }

        .cta {
            margin-top: 3rem;
            padding: 2rem;
            background: rgba(204, 255, 0, 0.1);
            border-radius: 12px;
            border: 2px solid #CCFF00;
        }

        .cta-title {
            font-size: 1.3rem;
            margin-bottom: 1rem;
            color: #CCFF00;
        }

        .cta-text {
            color: #aaa;
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }

        .cta-link {
            color: #CCFF00;
            text-decoration: none;
            font-weight: 600;
            border-bottom: 2px solid #CCFF00;
            transition: opacity 0.2s;
        }

        .cta-link:hover {
            opacity: 0.7;
        }

        .start-screen, .test-screen {
            display: none;
        }

        .start-screen.active, .test-screen.active {
            display: block;
        }

        .start-button {
            margin-top: 2rem;
        }

        footer {
            margin-top: 4rem;
            color: #666;
            font-size: 0.85rem;
        }

        footer a {
            color: #CCFF00;
            text-decoration: none;
        }

        @media (max-width: 600px) {
            .button-group {
                flex-direction: column;
            }

            button {
                width: 100%;
            }

            .color-display {
                height: 200px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Start Screen -->
        <div class="start-screen active">
            <h1>Is My Cifeaux?</h1>
            <p class="subtitle">
                Test your ability to recognize the one true cifeaux (#CCFF00).<br>
                Six adaptive questions. Personality-based verdict.
            </p>
            <div class="color-display" style="background: #CCFF00;"></div>
            <p class="color-code">The One True Cifeaux: #CCFF00</p>
            <button class="start-button" onclick="startTest()">Start Test</button>
            <footer>
                Inspired by <a href="https://ismy.blue/" target="_blank">ismy.blue</a> •
                Part of the <a href="https://ccff00.com" target="_blank">CCFF00</a> brand
            </footer>
        </div>

        <!-- Test Screen -->
        <div class="test-screen">
            <h1>Is My Cifeaux?</h1>
            <div class="color-display" id="colorDisplay"></div>
            <p class="color-code" id="colorCode"></p>
            <p class="question">Is this cifeaux?</p>
            <div class="button-group">
                <button onclick="answer(true)">Yes</button>
                <button onclick="answer(false)">No</button>
            </div>
            <p class="progress" id="progress"></p>
        </div>

        <!-- Results Screen -->
        <div class="results">
            <h1>Is My Cifeaux?</h1>
            <div class="verdict" id="verdict"></div>
            <p class="verdict-description" id="verdictDesc"></p>

            <div class="gradient-container">
                <div class="gradient" id="gradient">
                    <div class="marker true-cifeaux" style="left: 50%;">
                        True Cifeaux<br>#CCFF00
                    </div>
                    <div class="range-indicator" id="userRange"></div>
                </div>
            </div>

            <div class="stats">
                <div class="stat-row">
                    <span class="stat-label">Your range:</span>
                    <span class="stat-value" id="rangeDisplay"></span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Accepted shades:</span>
                    <span class="stat-value" id="acceptedCount"></span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Perception bias:</span>
                    <span class="stat-value" id="biasDisplay"></span>
                </div>
            </div>

            <div class="cta">
                <div class="cta-title">Want to own your own colour?</div>
                <p class="cta-text">
                    This is what happens when you commit to a brand.
                    Learn more about the CCFF00 project and how to build your own cultural brand.
                </p>
                <a href="https://ccff00.com" class="cta-link">Explore CCFF00 →</a>
            </div>

            <button onclick="location.reload()" style="margin-top: 2rem;">Test Again</button>

            <footer>
                Inspired by <a href="https://ismy.blue/" target="_blank">ismy.blue</a> •
                Part of the <a href="https://ccff00.com" target="_blank">CCFF00</a> brand
            </footer>
        </div>
    </div>

    <script>
        // Adaptive colour pool - organized by spectrum position
        const colourPool = {
            veryYellow: [
                { hex: '#FFFF00', name: 'Pure Yellow', value: 0 },
                { hex: '#FFFF33', name: 'Canary Yellow', value: 1 },
                { hex: '#FFFF66', name: 'Lemon Yellow', value: 2 }
            ],
            yellow: [
                { hex: '#EEFF00', name: 'Bright Yellow', value: 3 },
                { hex: '#EEFF33', name: 'Sunshine Yellow', value: 4 },
                { hex: '#DDFF00', name: 'Electric Yellow', value: 5 }
            ],
            cifeaux: [
                { hex: '#CCFF00', name: 'True Cifeaux', value: 6 }
            ],
            green: [
                { hex: '#BBFF00', name: 'Yellow-Green', value: 7 },
                { hex: '#AAFF33', name: 'Chartreuse', value: 8 },
                { hex: '#AAFF00', name: 'Lime Green', value: 9 }
            ],
            veryGreen: [
                { hex: '#99FF00', name: 'Spring Green', value: 10 },
                { hex: '#88FF00', name: 'Bright Lime', value: 11 },
                { hex: '#77FF00', name: 'Lawn Green', value: 12 }
            ]
        };

        let currentQuestion = 0;
        let maxQuestions = 6;
        let answers = [];
        let shownColours = [];
        let userBias = 0; // Tracks if user leans yellow (negative) or green (positive)

        function startTest() {
            // Track start event
            gtag('event', 'test_start', {
                'event_category': 'engagement'
            });

            document.querySelector('.start-screen').classList.remove('active');
            document.querySelector('.test-screen').classList.add('active');

            showColour();
        }

        function selectColourAdaptively() {
            let colour;

            if (currentQuestion === 0) {
                // Start with true cifeaux
                colour = colourPool.cifeaux[0];
            } else if (currentQuestion === 1) {
                // Second question: go yellow
                colour = colourPool.yellow[Math.floor(Math.random() * colourPool.yellow.length)];
            } else if (currentQuestion === 2) {
                // Third question: go green
                colour = colourPool.green[Math.floor(Math.random() * colourPool.green.length)];
            } else {
                // Adaptive selection based on previous answers
                if (userBias < -1) {
                    // User is saying yellow shades are cifeaux, show very yellow
                    colour = colourPool.veryYellow[Math.floor(Math.random() * colourPool.veryYellow.length)];
                } else if (userBias > 1) {
                    // User is saying green shades are cifeaux, show very green
                    colour = colourPool.veryGreen[Math.floor(Math.random() * colourPool.veryGreen.length)];
                } else if (userBias < 0) {
                    // Slight yellow bias
                    colour = colourPool.yellow[Math.floor(Math.random() * colourPool.yellow.length)];
                } else if (userBias > 0) {
                    // Slight green bias
                    colour = colourPool.green[Math.floor(Math.random() * colourPool.green.length)];
                } else {
                    // No bias, show cifeaux again or random mid-range
                    const pool = Math.random() > 0.5 ? colourPool.yellow : colourPool.green;
                    colour = pool[Math.floor(Math.random() * pool.length)];
                }
            }

            // Ensure we don't show the same colour twice
            while (shownColours.includes(colour.hex)) {
                const allColours = [
                    ...colourPool.veryYellow,
                    ...colourPool.yellow,
                    ...colourPool.cifeaux,
                    ...colourPool.green,
                    ...colourPool.veryGreen
                ];
                colour = allColours[Math.floor(Math.random() * allColours.length)];
            }

            return colour;
        }

        function showColour() {
            const colour = selectColourAdaptively();
            shownColours.push(colour.hex);

            document.getElementById('colorDisplay').style.background = colour.hex;
            document.getElementById('colorCode').textContent = colour.hex;
            document.getElementById('progress').textContent = `${currentQuestion + 1} of ${maxQuestions}`;

            // Store current colour for answer processing
            window.currentColour = colour;
        }

        function answer(isCifeaux) {
            const colour = window.currentColour;

            // Track answer
            answers.push({
                colour: colour.hex,
                value: colour.value,
                isCifeaux: isCifeaux
            });

            // Update bias based on answer
            if (isCifeaux) {
                if (colour.value < 6) {
                    // Accepted a yellow shade
                    userBias -= 1;
                } else if (colour.value > 6) {
                    // Accepted a green shade
                    userBias += 1;
                }
            }

            // Track individual answer
            gtag('event', 'answer', {
                'event_category': 'test',
                'event_label': colour.hex,
                'value': isCifeaux ? 1 : 0
            });

            currentQuestion++;

            if (currentQuestion < maxQuestions) {
                showColour();
            } else {
                showResults();
            }
        }

        function showResults() {
            document.querySelector('.test-screen').classList.remove('active');
            document.querySelector('.results').classList.add('active');

            // Calculate results
            const yesAnswers = answers.filter(a => a.isCifeaux);
            const acceptedCount = yesAnswers.length;

            // Find range boundaries (values, not indices)
            let minValue = yesAnswers.length > 0 ? Math.min(...yesAnswers.map(a => a.value)) : -1;
            let maxValue = yesAnswers.length > 0 ? Math.max(...yesAnswers.map(a => a.value)) : -1;

            // Determine verdict
            let verdict, description, verdictType;

            if (acceptedCount === 0) {
                verdict = "The Skeptic";
                verdictType = "skeptic";
                description = "Not a single shade passed your test. You're either a purist with impossible standards or you're trolling. Either way, respect the commitment.";
            } else if (acceptedCount === 1 && yesAnswers[0].hex === '#CCFF00') {
                verdict = "The Purist";
                verdictType = "purist";
                description = "You accept only #CCFF00 and nothing else. You understand that cifeaux is not a range—it's a religion.";
            } else if (acceptedCount <= 2) {
                verdict = "The Connoisseur";
                verdictType = "connoisseur";
                description = "You have refined taste and strict boundaries. You know cifeaux when you see it, and you're not easily fooled.";
            } else if (acceptedCount <= 4) {
                verdict = "The Pragmatist";
                verdictType = "pragmatist";
                description = "You understand that cifeaux is a vibe, not just a hex code. There's room for interpretation, but you still have standards.";
            } else if (acceptedCount <= 5) {
                verdict = "The Expansionist";
                verdictType = "expansionist";
                description = "Your cifeaux territory is broad. You see the family resemblance across the yellow-green spectrum. Bold.";
            } else {
                verdict = "The Visionary";
                verdictType = "visionary";
                description = "Every shade is cifeaux if you believe hard enough. You're either colourblind or operating on a higher plane of consciousness.";
            }

            document.getElementById('verdict').textContent = verdict;
            document.getElementById('verdictDesc').textContent = description;

            // Display range on gradient (normalized to 0-100%)
            if (minValue >= 0 && maxValue >= 0) {
                const minPercent = (minValue / 12) * 100; // 12 is max value
                const maxPercent = (maxValue / 12) * 100;
                const rangeWidth = maxPercent - minPercent;

                const rangeEl = document.getElementById('userRange');
                rangeEl.style.left = minPercent + '%';
                rangeEl.style.width = Math.max(rangeWidth, 3) + '%';
            }

            // Stats
            const rangeColours = yesAnswers.map(a => a.colour).join(', ');
            document.getElementById('rangeDisplay').textContent = rangeColours || 'None';
            document.getElementById('acceptedCount').textContent = `${acceptedCount} of ${maxQuestions}`;

            // Bias calculation
            const avgValue = yesAnswers.length > 0
                ? yesAnswers.reduce((sum, a) => sum + a.value, 0) / yesAnswers.length
                : 6;

            let bias;
            if (avgValue < 5) {
                bias = "More yellow ←";
            } else if (avgValue > 7) {
                bias = "More green →";
            } else {
                bias = "Perfectly balanced";
            }
            document.getElementById('biasDisplay').textContent = bias;

            // Create gradient spanning full spectrum
            const allColours = [
                ...colourPool.veryYellow,
                ...colourPool.yellow,
                ...colourPool.cifeaux,
                ...colourPool.green,
                ...colourPool.veryGreen
            ].sort((a, b) => a.value - b.value);

            const gradientStops = allColours.map((c, i) => {
                const position = (c.value / 12) * 100;
                return `${c.hex} ${position}%`;
            }).join(', ');

            document.getElementById('gradient').style.background = `linear-gradient(to right, ${gradientStops})`;

            // Save results to database
            saveResults({
                verdict: verdictType,
                acceptedCount: acceptedCount,
                bias: bias,
                answers: answers,
                timestamp: new Date().toISOString()
            });

            // Track completion
            gtag('event', 'test_complete', {
                'event_category': 'engagement',
                'event_label': verdictType,
                'value': acceptedCount
            });
        }

        function saveResults(data) {
            // Send results to PHP backend
            fetch('save-results.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(result => {
                console.log('Results saved:', result);
            })
            .catch(error => {
                console.error('Error saving results:', error);
            });
        }
    </script>
</body>
</html>
